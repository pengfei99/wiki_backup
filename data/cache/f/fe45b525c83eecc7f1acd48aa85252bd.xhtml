
<h1 class="sectionedit1" id="projet_noe_symfony">Projet NoE Symfony</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> 10.70.3.21</div>
</li>
<li class="level1"><div class="li"> CCLinNoeP01</div>
</li>
<li class="level1"><div class="li"> Centos 7</div>
</li>
<li class="level1"><div class="li"> 2 vCPU</div>
</li>
<li class="level1"><div class="li"> 4096 Mo RAM</div>
</li>
</ul>

</div>
<!-- EDIT1 SECTION "Projet NoE Symfony" [1-104] -->
<h2 class="sectionedit2" id="instancier_vm_centos7_sur_vmware">Instancier VM Centos7 sur VMware</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "Instancier VM Centos7 sur VMware" [105-149] -->
<h3 class="sectionedit3" id="deployer_la_vm_a_partir_d_un_template">Déployer la VM à partir d&#039;un template</h3>
<div class="level3">

<p>
<code>Template Centos 7</code> &gt; <code>Déployer vers une nouvelle machine virtuelle</code>
</p>

</div>
<!-- EDIT3 SECTION "Déployer la VM à partir d'un template" [150-273] -->
<h3 class="sectionedit4" id="changer_l_ip">Changer l&#039;IP</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Ouvrir la console et se connecter en tant que <em>bioaster</em></div>
</li>
</ul>
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=0" title="Télécharger un extrait" class="mediafile mf_">/etc/sysconfig/network-scripts/ifcfg-ens192</a></dt>
<dd><pre class="code text">TYPE=Ethernet
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=no
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
NAME=ens192
UUID=dc87549e-2b8a-4a9d-b07e-94e722ead4c3
DEVICE=ens192
ONBOOT=yes
DNS1=10.69.1.31
DNS2=10.69.1.32
DOMAIN=&quot;in2p3.fr bioaster.org bioaster.local&quot;
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_PRIVACY=no
IPADDR=10.70.3.21
PREFIX=24
GATEWAY=10.70.3.1</pre>
</dd></dl>

</div>
<!-- EDIT4 SECTION "Changer l'IP" [274-812] -->
<h3 class="sectionedit5" id="mettre_a_jour_le_systeme">Mettre à jour le système</h3>
<div class="level3">
<pre class="code">sudo yum update</pre>

</div>
<!-- EDIT5 SECTION "Mettre à jour le système" [813-878] -->
<h3 class="sectionedit6" id="desactiver_selinux">Désactiver SELinux</h3>
<div class="level3">

<p>
Remplacer la ligne <code>SELINUX=enforcing</code> en <code>SELINUX=disabled</code>
</p>
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=2" title="Télécharger un extrait" class="mediafile mf_">/etc/selinux/config</a></dt>
<dd><pre class="code text"># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of three two values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected. 
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted </pre>
</dd></dl>

</div>
<!-- EDIT6 SECTION "Désactiver SELinux" [879-1555] -->
<h3 class="sectionedit7" id="changer_le_reseau_de_la_vm">Changer le réseau de la VM</h3>
<div class="level3">

<p>
Eteindre la VM &gt; Clic doit sur la VM &gt; <code>Modifier les propriétés de machine virtuelle</code> &gt; <code>Adaptateur réseau</code> &gt; <code>dvPortServer-Scientific-VL3</code>
</p>

</div>
<!-- EDIT7 SECTION "Changer le réseau de la VM" [1556-1742] -->
<h3 class="sectionedit8" id="changer_le_nom_de_la_vm">Changer le nom de la VM</h3>
<div class="level3">
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=3" title="Télécharger un extrait" class="mediafile mf_">/etc/hostname</a></dt>
<dd><pre class="code text">cclinnoep01.bioaster.local</pre>
</dd></dl>

</div>
<!-- EDIT8 SECTION "Changer le nom de la VM" [1743-1835] -->
<h3 class="sectionedit9" id="changer_les_nameserver">Changer les &#039;&#039;nameserver&#039;&#039;</h3>
<div class="level3">
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=4" title="Télécharger un extrait" class="mediafile mf_conf_">/etc/resolv.conf </a></dt>
<dd><pre class="code text"># Generated by NetworkManager
search in2p3.fr bioaster.org bioaster.local
nameserver 10.69.1.31
nameserver 10.69.1.32</pre>
</dd></dl>

</div>
<!-- EDIT9 SECTION "Changer les ''nameserver''" [1836-2027] -->
<h3 class="sectionedit10" id="autoriser_cles_ssh">Autoriser clés SSH</h3>
<div class="level3">
<pre class="code">mkdir ~/.ssh
chmod 700 ~/.ssh
vi ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys</pre>
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=6" title="Télécharger un extrait" class="mediafile mf_ssh_authorized_keys">~/.ssh/authorized_keys</a></dt>
<dd><pre class="code text">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6W2UE3v/El6f/1vhrDH4vT7x/ipvgIGqgG1fxlDTRBx5AMN9NtsJouKDnbEG4iRDUR31i4+jbXbeDCaHiJd7g2Q0AJOS4l8MuyNe2v1DJH+GkZa/JVJX7IKaTpYxUpUpoOR/ZqD66KjpkjXSVN0MhvaoIDfdRupYi/P2glwCVOoOOMjJ1CLNnxroRwoidn/vz5es8F4fXRWwoIAFT/kzj/t82K2GcwYuabnPzU7yME1+/R6b23F/Mb1r0U/fFwZ66o+0/scgqQ93IGncUFrKhvDSPWiZ0XijE4m354JlvWTLaxekroK+tEfp8b6L9w1ZP6+T8jAsArSg8hiam7APF cauchard@pikachu</pre>
</dd></dl>

</div>
<!-- EDIT10 SECTION "Autoriser clés SSH" [2028-2600] -->
<h2 class="sectionedit11" id="configurer_noe">Configurer NoE</h2>
<div class="level2">

</div>
<!-- EDIT11 SECTION "Configurer NoE" [2601-2628] -->
<h3 class="sectionedit12" id="installation_des_packages">Installation des packages</h3>
<div class="level3">
<pre class="code">sudo yum install git postgresql composer nodejs nodejs-less
sudo yum remove php php-common</pre>

</div>
<!-- EDIT12 SECTION "Installation des packages" [2629-2768] -->
<h3 class="sectionedit13" id="installation_de_postgresql_93">Installation de Postgresql 9.3</h3>
<div class="level3">
<pre class="code">sudo rpm -iUvh http://yum.postgresql.org/9.3/redhat/rhel-7-x86_64/pgdg-centos93-9.3-1.noarch.rpm
sudo yum -y update
sudo yum -y install postgresql93 postgresql93-server postgresql93-contrib postgresql93-libs</pre>

</div>
<!-- EDIT13 SECTION "Installation de Postgresql 9.3" [2769-3030] -->
<h3 class="sectionedit14" id="demarrer_postgresql_93">Démarrer Postgresql 9.3</h3>
<div class="level3">
<pre class="code">sudo systemctl enable postgresql-9.3
sudo /usr/pgsql-9.3/bin/postgresql93-setup initdb
sudo systemctl start postgresql-9.3</pre>

</div>
<!-- EDIT14 SECTION "Démarrer Postgresql 9.3" [3031-3201] -->
<h3 class="sectionedit15" id="installation_de_php_56">Installation de PHP 5.6</h3>
<div class="level3">
<pre class="code">sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
sudo yum update
sudo yum install php56w php56w-opcache php56w-pdo php56w-pgsql</pre>

</div>
<!-- EDIT15 SECTION "Installation de PHP 5.6" [3202-3484] -->
<h3 class="sectionedit16" id="installer_le_depot_git_noe">Installer le dépôt Git NoE</h3>
<div class="level3">
<pre class="code">git clone https://gitlab.in2p3.fr/bioaster/NoE.git
Cloning into &#039;NoE&#039;...
Username for &#039;https://gitlab.in2p3.fr&#039;: audrey.cauchard@bioaster.org
Password for &#039;https://audrey.cauchard@bioaster.org@gitlab.in2p3.fr&#039;: </pre>

</div>
<!-- EDIT16 SECTION "Installer le dépôt Git NoE" [3485-3749] -->
<h3 class="sectionedit17" id="indiquer_la_timezone_dans_php">Indiquer la &#039;&#039;timezone&#039;&#039; dans PHP</h3>
<div class="level3">
<pre class="code">sudo vi /etc/php.ini</pre>

<p>
Décommenter et rajouter<code>date.timezone = “Europe/Amsterdam”</code>
</p>

</div>
<!-- EDIT17 SECTION "Indiquer la ''timezone'' dans PHP" [3750-3890] -->
<h3 class="sectionedit18" id="installer_noe">Installer NoE</h3>
<div class="level3">
<pre class="code">chown -R bioaster:bioaster NoE
cd NoE/
composer install</pre>
<pre class="code">database_driver: pdo_pgsql
database_host: 127.0.0.1
database_port: null
database_name: symfony
database_user: root
database_password: null
dev_database_driver: pdo_pgsql
dev_database_host: 127.0.0.1
dev_database_port: null
dev_database_name: lims_dev
dev_database_user: lims_dev
dev_database_password: lims
test_database_driver: pdo_pgsql
test_database_host: 127.0.0.1
test_database_port: null
test_database_name: lims_test
test_database_user: lims_test
test_database_password: lims
mailer_transport: smtp
mailer_host: 127.0.0.1
mailer_user: null
mailer_password: null
secret: s4rtf5huy7gtfrRRRE
node_path: /usr/bin/node
node_modules_path: /usr/lib/node_modules</pre>

</div>
<!-- EDIT18 SECTION "Installer NoE" [3891-4659] -->
<h3 class="sectionedit19" id="creation_des_users_et_des_bases_de_donnees">Creation des Users et des bases de données</h3>
<div class="level3">
<pre class="code">sudo su postgres
createuser --no-createdb --no-createrole -P -e lims_dev
Enter password for new role: 
Enter it again: 
CREATE ROLE lims_dev PASSWORD &#039;md562ed2ec8e6ef606eb87b27fc5aa6a224&#039; NOSUPERUSER NOCREATEDB NOCREATEROLE INHERIT LOGIN;

createuser --no-createdb --no-createrole -P -e lims_test
Enter password for new role: 
Enter it again: 
CREATE ROLE lims_test PASSWORD &#039;md598e00ef65c66f699c82a2b05bab7ec36&#039; NOSUPERUSER NOCREATEDB NOCREATEROLE INHERIT LOGIN;

createdb -e -O lims_dev lims_dev
CREATE DATABASE lims_dev OWNER lims_dev;

createdb -e -O lims_test lims_test
CREATE DATABASE lims_test OWNER lims_test;

exit</pre>

</div>
<!-- EDIT19 SECTION "Creation des Users et des bases de données" [4660-5351] -->
<h3 class="sectionedit20" id="modification_de_pg_hbaconf">Modification de &#039;&#039;pg_hba.conf&#039;&#039;</h3>
<div class="level3">
<pre class="code">sudo -u postgres psql template1
ALTER USER postgres with encrypted password &#039;postgres&#039;;
show hba_file ;</pre>

<p>
<code>CTRL+D</code>
</p>
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=17" title="Télécharger un extrait" class="mediafile mf_conf">/var/lib/pgsql/9.3/data/pg_hba.conf</a></dt>
<dd><pre class="code text"># PostgreSQL Client Authentication Configuration File
# ===================================================
#
# Refer to the &quot;Client Authentication&quot; section in the PostgreSQL
# documentation for a complete description of this file.  A short
# synopsis follows.
#
# This file controls: which hosts are allowed to connect, how clients
# are authenticated, which PostgreSQL user names they can use, which
# databases they can access.  Records take one of these forms:
#
# local      DATABASE  USER  METHOD  [OPTIONS]
# host       DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
# hostssl    DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
# hostnossl  DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
#
# (The uppercase items must be replaced by actual values.)
#
# The first field is the connection type: &quot;local&quot; is a Unix-domain
# socket, &quot;host&quot; is either a plain or SSL-encrypted TCP/IP socket,
# &quot;hostssl&quot; is an SSL-encrypted TCP/IP socket, and &quot;hostnossl&quot; is a
# plain TCP/IP socket.
#
# DATABASE can be &quot;all&quot;, &quot;sameuser&quot;, &quot;samerole&quot;, &quot;replication&quot;, a
# database name, or a comma-separated list thereof. The &quot;all&quot;
# keyword does not match &quot;replication&quot;. Access to replication
# must be enabled in a separate record (see example below).
#
# USER can be &quot;all&quot;, a user name, a group name prefixed with &quot;+&quot;, or a
# comma-separated list thereof.  In both the DATABASE and USER fields
# you can also write a file name prefixed with &quot;@&quot; to include names
# from a separate file.
#
# ADDRESS specifies the set of hosts the record matches.  It can be a
# host name, or it is made up of an IP address and a CIDR mask that is
# an integer (between 0 and 32 (IPv4) or 128 (IPv6) inclusive) that
# specifies the number of significant bits in the mask.  A host name
# that starts with a dot (.) matches a suffix of the actual host name.
# Alternatively, you can write an IP address and netmask in separate
# columns to specify the set of hosts.  Instead of a CIDR-address, you
# can write &quot;samehost&quot; to match any of the server's own IP addresses,
# or &quot;samenet&quot; to match any address in any subnet that the server is
# directly connected to.
#
# METHOD can be &quot;trust&quot;, &quot;reject&quot;, &quot;md5&quot;, &quot;password&quot;, &quot;gss&quot;, &quot;sspi&quot;,
# &quot;krb5&quot;, &quot;ident&quot;, &quot;peer&quot;, &quot;pam&quot;, &quot;ldap&quot;, &quot;radius&quot; or &quot;cert&quot;.  Note that
# &quot;password&quot; sends passwords in clear text; &quot;md5&quot; is preferred since
# it sends encrypted passwords.
#
# OPTIONS are a set of options for the authentication in the format
# NAME=VALUE.  The available options depend on the different
# authentication methods -- refer to the &quot;Client Authentication&quot;
# section in the documentation for a list of which options are
# available for which authentication methods.
#
# Database and user names containing spaces, commas, quotes and other
# special characters must be quoted.  Quoting one of the keywords
# &quot;all&quot;, &quot;sameuser&quot;, &quot;samerole&quot; or &quot;replication&quot; makes the name lose
# its special character, and just match a database or username with
# that name.
#
# This file is read on server startup and when the postmaster receives
# a SIGHUP signal.  If you edit the file on a running system, you have
# to SIGHUP the postmaster for the changes to take effect.  You can
# use &quot;pg_ctl reload&quot; to do that.
&nbsp;
# Put your actual configuration here
# ----------------------------------
#
# If you want to allow non-local connections, you need to add more
# &quot;host&quot; records.  In that case you will also need to make PostgreSQL
# listen on a non-local interface via the listen_addresses
# configuration parameter, or via the -i or -h command line switches.
&nbsp;
&nbsp;
&nbsp;
# TYPE  DATABASE        USER            ADDRESS                 METHOD
&nbsp;
# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     peer
# IPv4 local connections:
host    all             all             127.0.0.1/32            ident
# IPv6 local connections:
host    all             all             ::1/128                 ident
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local   replication     postgres                                peer
#host    replication     postgres        127.0.0.1/32            ident
#host    replication     postgres        ::1/128                 ident</pre>
</dd></dl>

<p>
On redemarre le serveur postgres via <code>sudo systemctl restart postgresql-9.3</code>
</p>

</div>
<!-- EDIT20 SECTION "Modification de ''pg_hba.conf''" [5352-9888] -->
<h3 class="sectionedit21" id="installation_des_migrations">Installation des migrations</h3>
<div class="level3">
<pre class="code">cd NoE/ (si pas déjà)
php app/console doctrine:database:drop --force
php app/console doctrine:database:create
php app/console cache:warmup --env=dev (spécifie son environnement [au choix prod, dev, test])
php app/console doctrine:migrations:status
php app/console doctrine:migrations:migrate</pre>

</div>
<!-- EDIT21 SECTION "Installation des migrations" [9889-10235] -->
<h3 class="sectionedit22" id="lancertester_le_serveur">Lancer/Tester le serveur</h3>
<div class="level3">
<pre class="code">php app/console server:run</pre>

</div>
<!-- EDIT22 SECTION "Lancer/Tester le serveur" [10236-10311] -->
<h3 class="sectionedit23" id="configurer_firewall">Configurer Firewall</h3>
<div class="level3">
<pre class="code">iptables -F</pre>
<pre class="code">sudo su -
firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --zone=public --permanent --add-service=https
firewall-cmd --add-port=8000/tcp --permanent 
firewall-cmd --reload </pre>

</div>
<!-- EDIT23 SECTION "Configurer Firewall" [10312-10577] -->
<h3 class="sectionedit24" id="deplacer_le_repertoire_dansvarwwwhtml">Déplacer le répertoire dans &#039;&#039;/var/www/html&#039;&#039;</h3>
<div class="level3">
<pre class="code">mv /home/bioaster/NoE /var/www/html/
chmod -R 775 /var/www/html/NoE
cd /var/www/html/NoE
php app/console server:start 10.70.3.21:8000</pre>

</div>
<!-- EDIT24 SECTION "Déplacer le répertoire dans ''/var/www/html''" [10578-10783] -->
<h2 class="sectionedit25" id="se_connecter_a_l_interface_web">Se connecter à l&#039;interface Web</h2>
<div class="level2">

<p>
Le serveur Schibboleth n&#039;est pas encore connecté à <abbr title="Network Of Experiments">NoE</abbr>. Afin de pourvoir utiliser toutes les fonctionnalités, il est nécessaire de simuler les données récupérées par Schibboleth.
</p>

</div>
<!-- EDIT25 SECTION "Se connecter à l'interface Web" [10784-11014] -->
<h3 class="sectionedit26" id="installer_modify_headers">Installer &#039;&#039;Modify Headers&#039;&#039;</h3>
<div class="level3">

<p>
Sous Firefox, cliquer à droites sur <code>Modules</code> puis recherche <code>Modify Headers</code> pour l&#039;installer.
</p>

</div>
<!-- EDIT26 SECTION "Installer ''Modify Headers''" [11015-11155] -->
<h3 class="sectionedit27" id="importer_les_donnees_test">Importer les données test</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Créer le fichier suivant via votre bloc-note.</div>
</li>
</ul>
<dl class="code">
<dt><a href="/_export/code/noe/noe_symfony?codeblock=23" title="Télécharger un extrait" class="mediafile mf_json">modifyheaders.json</a></dt>
<dd><pre class="code text">[{&quot;action&quot;:&quot;Modify&quot;,&quot;name&quot;:&quot;SHIB-USERNAME&quot;,&quot;value&quot;:&quot;Michel&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-FIRSTNAME&quot;,&quot;value&quot;:&quot;Jean-Michel&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Modify&quot;,&quot;name&quot;:&quot;SHIB-USER&quot;,&quot;value&quot;:&quot;mmichel@bioaster.org&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Modify&quot;,&quot;name&quot;:&quot;SHIB-EMAIL&quot;,&quot;value&quot;:&quot;mmichel@bioaster.org&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-LABS&quot;,&quot;value&quot;:&quot;BIOASTER*DST*DUT*UTEC06&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-SITE&quot;,&quot;value&quot;:&quot;BIOASTER1&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-CITY&quot;,&quot;value&quot;:&quot;Lyon&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-COUNTRY&quot;,&quot;value&quot;:&quot;France&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-WPS&quot;,&quot;value&quot;:&quot;PROJECT1::WP1;PROJECT1::WP2;PROJECT2::WP0;PROJECT3::WP4;PROJECT3::WP1&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:false},{&quot;action&quot;:&quot;Add&quot;,&quot;name&quot;:&quot;SHIB-WPS&quot;,&quot;value&quot;:&quot;EBODIAG::WP3;EBODIAG::WP3;EBODIAG::WP3;EBODIAG::WP3;EBODIAG::WP3;EBODIAG::WP3;EBODIAG::WP3;REALISM::WP3;REALISM::WP3;REALISM::WP3;REALISM::WP3&quot;,&quot;comment&quot;:&quot;&quot;,&quot;enabled&quot;:true}]</pre>
</dd></dl>
<ul>
<li class="level1"><div class="li"> Dans Firefox, cliquer sur l’icône <code>Modify Headers</code> <a href="/_detail/967-64.png?id=noe%3Anoe_symfony" class="media" title="967-64.png"><img src="/_media/967-64.png?w=35&amp;tok=e40a0f" class="media" alt="" width="35" /></a> &gt; <code>Open Modify Headers</code> &gt; <code>Options</code> &gt; <code>Import Headers</code> &gt; Sélectionner votre fichier.</div>
</li>
<li class="level1"><div class="li"> Activer tous items sauf <code>SHIB-WPS PROJECT1::WP1</code> <a href="/_detail/modifyheaders.png?id=noe%3Anoe_symfony" class="media" title="modifyheaders.png"><img src="/_media/modifyheaders.png?w=400&amp;tok=8b7817" class="media" alt="" width="400" /></a></div>
</li>
<li class="level1"><div class="li"> Cliquer sur <code>Start</code></div>
</li>
</ul>

</div>
<!-- EDIT27 SECTION "Importer les données test" [11156-] -->